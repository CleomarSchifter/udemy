---
title: "Model tuning: Otimizando os parâmetros do modelo"
output: html_document
---

## Orientacoes para execucao
Todos os pacotes utilizados neste script devem ser/estar instalados no seu ambiente de desenvolvimento.
Para instalar um pacote use o comando install.packages("nome_do_pacote")

## Carrega os pacotes
```{r, cache=FALSE, message=FALSE, warning=FALSE}
library(randomForest)
library(mlbench)
library(caret)
```

## Carrega os dados
```{r}
data(Sonar)
dataset <- Sonar
x <- dataset[,1:60]
y <- dataset[,61]
```

## Cria algumas variáveis gerais
```{r}
set.seed(123)
metric <- "Accuracy"
mtry <- sqrt(ncol(x))
```

## Cria um modelo com parâmetros padrão. Note que o valor o parâmetro mtry foi fixado com um valor constante.
```{r, cache=FALSE, message=FALSE, warning=FALSE}
trainControl <- trainControl(method="repeatedcv", number=10, repeats=3)
tunegrid <- expand.grid(.mtry=mtry)
rfDefault <- train(Class~., data=dataset, method="rf", metric=metric, tuneGrid=tunegrid,trControl=trainControl)
print(rfDefault)
```

## Otimização do modelo com Random Search
```{r, cache=FALSE, message=FALSE, warning=FALSE}
trainControl <- trainControl(method="repeatedcv", number=10, repeats=3, search="random")
rfRandom <- train(Class~., data=dataset, method="rf", metric=metric, tuneLength=15,trControl=trainControl)
print(rfRandom)
```

Gráfico dos parâmetros testados
```{r}
plot(rfRandom)
```

Melhor parâmetro escolhido
```{r}
print(rfRandom$bestTune)
```

## Otimização do modelo com Grid Search
```{r}
trainControl <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
tunegrid <- expand.grid(.mtry=c(1:15))
rfGrid <- train(Class~., data=dataset, method="rf", metric=metric, tuneGrid=tunegrid,trControl=trainControl)
#tunegrid <- expand.grid(.cp=seq(0,0.1,by=0.01)) for method="rpart"
print(rfGrid)
```

Gráfico dos parâmetros testados
```{r}
plot(rfGrid)
```

Melhor parâmetro escolhido
```{r}
print(rfGrid$bestTune)
```


Referências: 
Jason Brownlee, Machine Learning Mastery